YUI.add("moodle-local_chemslate-mathjaxeditor",function(e,t){M.local_chemslate=M.local_chemslate||{},M.local_chemslate.MathJaxEditor=function(t){function s(){r.forEach(function(t){var n=i.get("node").one("#"+t[1].id);if(!n)return;if(!t[1]||!t[1]["class"]||t[1]["class"]!=="blank"){var s=(new e.DD.Drag({node:n})).plug(e.Plugin.DDProxy,{resizeFrame:!1,moveOnEnd:!1});s.on("drag:start",function(){var n=e.guid();this.get("dragNode").set("innerHTML",""),MathJax.Hub.Queue(["addElement",MathJax.HTML,this.get("dragNode").getDOMNode(),"span",{id:n},[["math",{},[e.JSON.parse(r.getItemByID(t[1].id))]]]]),MathJax.Hub.Queue(["Typeset",MathJax.Hub,n])})}var u=new e.DD.Drop({node:n});u.on("drop:hit",function(e){var n=e.drag.get("node").get("id");e.drag.get("data")?r.insertSnippet(t[1].id,r.createItem(e.drag.get("data"))):n!==t[1].id&&r.isItem(n)&&!i.get("node").one("#"+n).one("#"+t[1].id)&&r.insertSnippet(e.drop.get("node").get("id"),r.removeSnippet(n)),o()}),u.on("drop:enter",function(e){e.stopPropagation(),i.get("node").all(".highlight",function(e){e.removeClass("highlight")}),this.get("node").addClass("highlight")}),u.on("drop:exit",function(){this.get("node").removeClass("highlight")})})}function o(){r.rekey(),i.get("node").setHTML(""),MathJax.Hub.Queue(["addElement",MathJax.HTML,i.get("node").getDOMNode(),"span",{},[["math",{},n]]]),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"canvas"]),MathJax.Hub.Queue(s)}var n=[],r=new M.local_chemslate.mSlots;r.slots.push(n),this.workspace=e.one(t).append('<div id="canvas" class="chemslate-workspace"/>');var i=new e.DD.Drop({node:this.workspace.one("#canvas")});this.canvas=i,this.render=o,this.addMath=function(e,t){r.append(r.createItem(t)),o()},this.clear=function(){n=[],r=new M.local_chemslate.mSlots,r.slots.push(n),o()},this.output=function(e){return e==="MathML"?i.get("node").one("script").getHTML():e==="HTML"?i.get("node").one("span").getHTML():r.output(e)},this.getHTML=function(){return i.get("node").one("span").getHTML()},this.redo=function(){r.redo(),o()},this.undo=function(){r.undo(),o()},o()}},"@VERSION@",{requires:["moodle-local_chemslate-snippeteditor","dd-proxy","dd-drop"]});
